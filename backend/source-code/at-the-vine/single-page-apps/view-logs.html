<!--
Jaye Hicks 2020

Lonesome Vine status single page web application.  User logon is required to access this application.
User ids and passwords are maintained in AWS Cognito.  Data that is displayed / updated by this
application is maintained across multiple AWS DynmoDB Tables.

Obligatory legal disclaimer:
 You are free to use this source code (this file and all other files 
 referenced in this file) "AS IS" WITHOUT WARRANTY OF ANY KIND, EITHER 
 EXPRESSED OR IMPLIED, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED 
 WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE. THE 
 ENTIRE RISK AS TO THE QUALITY AND PERFORMANCE OF THIS SOURCE CODE IS WITH 
 YOU.  SHOULD THE SOURCE CODE PROVE DEFECTIVE, YOU ASSUME THE COST OF ALL 
 NECESSARY SERVICING, REPAIR OR CORRECTION. See the GNU GENERAL PUBLIC 
 LICENSE Version 3, 29 June 2007 for more details.
-->
<!DOCTYPE html>
<html>
<head>
<title>Lonesome Vine Operations Management</title>
<meta charset="UTF-8">
</head>
<body>
<img src="banner_small.jpg"><br>
<span id = "messageToUser">Howdy! I don't know who you are.  Please log on at the bottom of this page.</span><br><br>

<fieldset style="width:750px">
<legend> Vineyard Staions Current Sensor Readings</legend>
<input type="submit" class="buttons" value="Refresh Display" id="vineyardStationsRefresh" style="width:110px">
<br>
<br>
<table border="1">
<tr>
  <th align="left" style="padding:5px">Station</th>
  <th align="left" style="padding:5px">Status</th>
  <th align="left" style="padding:5px">Last Reported</th>
  <th align="left" style="padding:5px">12" SMS</th>
  <th align="left" style="padding:5px">24" SMS</th>
  <th align="left" style="padding:5px">48" SMS</th>   
  <th align="left" style="padding:5px">&#176F</th>
  <th align="left" style="padding:5px">Volts</th>
</tr>
<tr>
  <td style="padding:3px">A02N</td>
  <td style="padding:3px" id="A02N_status_color"> <span id = "A02N_status">...</span> </td>
  <td style="padding:3px" id="A02N_time_color"> <span id = "A02N_time">...</span> </td>
  <td style="padding:3px" id="A02N_sms1_color"> <span id = "A02N_sms1">...</span></td>
  <td style="padding:3px" id="A02N_sms2_color"> <span id = "A02N_sms2">...</span></td>
  <td style="padding:3px" id="A02N_sms3_color"> <span id = "A02N_sms3">...</span></td>
  <td style="padding:3px" id="A02N_temp_color"> <span id = "A02N_temp">...</span> </td>
  <td style="padding:3px" id="A02N_battery_color"> <span id = "A02N_battery">...</span> </td>
</tr>
<tr>
  <td style="padding:3px">A02S</td>
  <td style="padding:3px" id="A02S_status_color"> <span id = "A02S_status">...</span> </td>
  <td style="padding:3px" id="A02S_time_color"> <span id = "A02S_time">...</span> </td>
  <td style="padding:3px" id="A02S_sms1_color"> <span id = "A02S_sms1">...</span></td>
  <td style="padding:3px" id="A02S_sms2_color"> <span id = "A02S_sms2">...</span></td>
  <td style="padding:3px" id="A02S_sms3_color"> <span id = "A02S_sms3">...</span></td>
  <td style="padding:3px" id="A02S_temp_color"> <span id = "A02S_temp">...</span> </td>
  <td style="padding:3px" id="A02S_battery_color"> <span id = "A02S_battery">...</span> </td>
</tr>
<tr>
  <td style="padding:3px">A08M</td>
  <td style="padding:3px" id="A08M_status_color"> <span id = "A08M_status">...</span> </td>
  <td style="padding:3px" id="A08M_time_color"> <span id = "A08M_time">...</span> </td>
  <td style="padding:3px" id="A08M_sms1_color"> <span id = "A08M_sms1">...</span></td>
  <td style="padding:3px" id="A08M_sms2_color"> <span id = "A08M_sms2">...</span></td>
  <td style="padding:3px" id="A08M_sms3_color"> <span id = "A08M_sms3">...</span></td>  
  <td style="padding:3px" id="A08M_temp_color"> <span id = "A08M_temp">...</span> </td>
  <td style="padding:3px" id="A08M_battery_color"> <span id = "A08M_battery">...</span> </td>  
</tr>
<tr>
  <td style="padding:3px">B02N</td>
  <td style="padding:3px" id="B02N_status_color"> <span id = "B02N_status">...</span> </td>
  <td style="padding:3px" id="B02N_time_color"> <span id = "B02N_time">...</span> </td>
  <td style="padding:3px" id="B02N_sms1_color"> <span id = "B02N_sms1">...</span></td>
  <td style="padding:3px" id="B02N_sms2_color"> <span id = "B02N_sms2">...</span></td>
  <td style="padding:3px" id="B02N_sms3_color"> <span id = "B02N_sms3">...</span></td>
  <td style="padding:3px" id="B02N_temp_color"> <span id = "B02N_temp">...</span> </td>
  <td style="padding:3px" id="B02N_battery_color"> <span id = "B02N_battery">...</span> </td>  
</tr>
<tr>
  <td style="padding:3px">B02S</td>
  <td style="padding:3px" id="B02S_status_color"> <span id = "B02S_status">...</span> </td>
  <td style="padding:3px" id="B02S_time_color"> <span id = "B02S_time">...</span> </td>
  <td style="padding:3px" id="B02S_sms1_color"> <span id = "B02S_sms1">...</span></td>
  <td style="padding:3px" id="B02S_sms2_color"> <span id = "B02S_sms2">...</span></td>
  <td style="padding:3px" id="B02S_sms3_color"> <span id = "B02S_sms3">...</span></td>  
  <td style="padding:3px" id="B02S_temp_color"> <span id = "B02S_temp">...</span> </td>
  <td style="padding:3px" id="B02S_battery_color"> <span id = "B02S_battery">...</span> </td> 
</tr>
<tr>
  <td style="padding:3px">B08M</td>
  <td style="padding:3px" id="B08M_status_color"> <span id = "B08M_status">...</span> </td>
  <td style="padding:3px" id="B08M_time_color"> <span id = "B08M_time">...</span> </td>
  <td style="padding:3px" id="B08M_sms1_color"> <span id = "B08M_sms1">...</span></td>
  <td style="padding:3px" id="B08M_sms2_color"> <span id = "B08M_sms2">...</span></td>
  <td style="padding:3px" id="B08M_sms3_color"> <span id = "B08M_sms3">...</span></td>  
  <td style="padding:3px" id="B08M_temp_color"> <span id = "B08M_temp">...</span> </td>
  <td style="padding:3px" id="B08M_battery_color"> <span id = "B08M_battery">...</span> </td>
</tr>
<tr>
  <td style="padding:3px">C02N</td>
  <td style="padding:3px" id="C02N_status_color"> <span id = "C02N_status">...</span> </td>
  <td style="padding:3px" id="C02N_time_color"> <span id = "C02N_time">...</span> </td>
  <td style="padding:3px" id="C02N_sms1_color"> <span id = "C02N_sms1">...</span></td>
  <td style="padding:3px" id="C02N_sms2_color"> <span id = "C02N_sms2">...</span></td>
  <td style="padding:3px" id="C02N_sms3_color"> <span id = "C02N_sms3">...</span></td>
  <td style="padding:3px" id="C02N_temp_color"> <span id = "C02N_temp">...</span> </td>
  <td style="padding:3px" id="C02N_battery_color"> <span id = "C02N_battery">...</span> </td> 
</tr>
<tr>
  <td style="padding:3px">C02S</td>
  <td style="padding:3px" id="C02S_status_color"> <span id = "C02S_status">...</span> </td>
  <td style="padding:3px" id="C02S_time_color"> <span id = "C02S_time">...</span> </td>
  <td style="padding:3px" id="C02S_sms1_color"> <span id = "C02S_sms1">...</span></td>
  <td style="padding:3px" id="C02S_sms2_color"> <span id = "C02S_sms2">...</span></td>
  <td style="padding:3px" id="C02S_sms3_color"> <span id = "C02S_sms3">...</span></td>
  <td style="padding:3px" id="C02S_temp_color"> <span id = "C02S_temp">...</span> </td>
  <td style="padding:3px" id="C02S_battery_color"> <span id = "C02S_battery">...</span> </td>
</tr>
<tr>
  <td style="padding:3px">C08M</td>
  <td style="padding:3px" id="C08M_status_color"> <span id = "C08M_status">...</span> </td>
  <td style="padding:3px" id="C08M_time_color"> <span id = "C08M_time">...</span> </td>
  <td style="padding:3px" id="C08M_sms1_color"> <span id = "C08M_sms1">...</span></td>
  <td style="padding:3px" id="C08M_sms2_color"> <span id = "C08M_sms2">...</span></td>
  <td style="padding:3px" id="C08M_sms3_color"> <span id = "C08M_sms3">...</span></td>
  <td style="padding:3px" id="C08M_temp_color"> <span id = "C08M_temp">...</span> </td>
  <td style="padding:3px" id="C08M_battery_color"> <span id = "C08M_battery">...</span> </td>
</tr>
<tr>
  <td style="padding:3px">D02N</td>
  <td style="padding:3px" id="D02N_status_color"> <span id = "D02N_status">...</span> </td>
  <td style="padding:3px" id="D02N_time_color"> <span id = "D02N_time">...</span> </td>
  <td style="padding:3px" id="D02N_sms1_color"> <span id = "D02N_sms1">...</span></td>
  <td style="padding:3px" id="D02N_sms2_color"> <span id = "D02N_sms2">...</span></td>
  <td style="padding:3px" id="D02N_sms3_color"> <span id = "D02N_sms3">...</span></td>
  <td style="padding:3px" id="D02N_temp_color"> <span id = "D02N_temp">...</span> </td>
  <td style="padding:3px" id="D02N_battery_color"> <span id = "D02N_battery">...</span> </td> 
</tr>
<tr>
  <td style="padding:3px">D02S</td>
  <td style="padding:3px" id="D02S_status_color"> <span id = "D02S_status">...</span> </td>
  <td style="padding:3px" id="D02S_time_color"> <span id = "D02S_time">...</span> </td>
  <td style="padding:3px" id="D02S_sms1_color"> <span id = "D02S_sms1">...</span></td>
  <td style="padding:3px" id="D02S_sms2_color"> <span id = "D02S_sms2">...</span></td>
  <td style="padding:3px" id="D02S_sms3_color"> <span id = "D02S_sms3">...</span></td>
  <td style="padding:3px" id="D02S_temp_color"> <span id = "D02S_temp">...</span> </td>
  <td style="padding:3px" id="D02S_battery_color"> <span id = "D02S_battery">...</span> </td>
</tr>
<tr>
  <td style="padding:3px">D08M</td>
  <td style="padding:3px" id="D08M_status_color"> <span id = "D08M_status">...</span> </td>
  <td style="padding:3px" id="D08M_time_color"> <span id = "D08M_time">...</span> </td>
  <td style="padding:3px" id="D08M_sms1_color"> <span id = "D08M_sms1">...</span></td>
  <td style="padding:3px" id="D08M_sms2_color"> <span id = "D08M_sms2">...</span></td>
  <td style="padding:3px" id="D08M_sms3_color"> <span id = "D08M_sms3">...</span></td>
  <td style="padding:3px" id="D08M_temp_color"> <span id = "D08M_temp">...</span> </td>
  <td style="padding:3px" id="D08M_battery_color"> <span id = "D08M_battery">...</span> </td>  
</tr>
<tr>
  <td style="padding:3px">E02N</td>
  <td style="padding:3px" id="E02N_status_color"> <span id = "E02N_status">...</span> </td>
  <td style="padding:3px" id="E02N_time_color"> <span id = "E02N_time">...</span> </td>
  <td style="padding:3px" id="E02N_sms1_color"> <span id = "E02N_sms1">...</span></td>
  <td style="padding:3px" id="E02N_sms2_color"> <span id = "E02N_sms2">...</span></td>
  <td style="padding:3px" id="E02N_sms3_color"> <span id = "E02N_sms3">...</span></td>
  <td style="padding:3px" id="E02N_temp_color"> <span id = "E02N_temp">...</span> </td>
  <td style="padding:3px" id="E02N_battery_color"> <span id = "E02N_battery">...</span> </td>  
</tr>
<tr>
  <td style="padding:3px">E02S</td>
  <td style="padding:3px" id="E02S_status_color"> <span id = "E02S_status">...</span> </td>
  <td style="padding:3px" id="E02S_time_color"> <span id = "E02S_time">...</span> </td>
  <td style="padding:3px" id="E02S_sms1_color"> <span id = "E02S_sms1">...</span></td>
  <td style="padding:3px" id="E02S_sms2_color"> <span id = "E02S_sms2">...</span></td>
  <td style="padding:3px" id="E02S_sms3_color"> <span id = "E02S_sms3">...</span></td>
  <td style="padding:3px" id="E02S_temp_color"> <span id = "E02S_temp">...</span> </td>
  <td style="padding:3px" id="E02S_battery_color"> <span id = "E02S_battery">...</span> </td> 
</tr>
<tr>
  <td style="padding:3px">E08M</td>
  <td style="padding:3px" id="E08M_status_color"> <span id = "E08M_status">...</span> </td>
  <td style="padding:3px" id="E08M_time_color"> <span id = "E08M_time">...</span> </td>
  <td style="padding:3px" id="E08M_sms1_color"> <span id = "E08M_sms1">...</span></td>
  <td style="padding:3px" id="E08M_sms2_color"> <span id = "E08M_sms2">...</span></td>
  <td style="padding:3px" id="E08M_sms3_color"> <span id = "E08M_sms3">...</span></td>
  <td style="padding:3px" id="E08M_temp_color"> <span id = "E08M_temp">...</span> </td>
  <td style="padding:3px" id="E08M_battery_color"> <span id = "E08M_battery">...</span> </td>
</tr>
<tr>
  <td style="padding:3px">F02N</td>
  <td style="padding:3px" id="F02N_status_color"> <span id = "F02N_status">...</span> </td>
  <td style="padding:3px" id="F02N_time_color"> <span id = "F02N_time">...</span> </td>
  <td style="padding:3px" id="F02N_sms1_color"> <span id = "F02N_sms1">...</span></td>
  <td style="padding:3px" id="F02N_sms2_color"> <span id = "F02N_sms2">...</span></td>
  <td style="padding:3px" id="F02N_sms3_color"> <span id = "F02N_sms3">...</span></td>
  <td style="padding:3px" id="F02N_temp_color"> <span id = "F02N_temp">...</span> </td>
  <td style="padding:3px" id="F02N_battery_color"> <span id = "F02N_battery">...</span> </td>  
</tr>
<tr>
  <td style="padding:3px">F02S</td>
  <td style="padding:3px" id="F02S_status_color"> <span id = "F02S_status">...</span> </td>
  <td style="padding:3px" id="F02S_time_color"> <span id = "F02S_time">...</span> </td>
  <td style="padding:3px" id="F02S_sms1_color"> <span id = "F02S_sms1">...</span></td>
  <td style="padding:3px" id="F02S_sms2_color"> <span id = "F02S_sms2">...</span></td>
  <td style="padding:3px" id="F02S_sms3_color"> <span id = "F02S_sms3">...</span></td>
  <td style="padding:3px" id="F02S_temp_color"> <span id = "F02S_temp">...</span> </td>
  <td style="padding:3px" id="F02S_battery_color"> <span id = "F02S_battery">...</span> </td>
</tr>
<tr>
  <td style="padding:3px">F08M</td>
  <td style="padding:3px" id="F08M_status_color"> <span id = "F08M_status">...</span> </td>
  <td style="padding:3px" id="F08M_time_color"> <span id = "F08M_time">...</span> </td>
  <td style="padding:3px" id="F08M_sms1_color"> <span id = "F08M_sms1">...</span></td>
  <td style="padding:3px" id="F08M_sms2_color"> <span id = "F08M_sms2">...</span></td>
  <td style="padding:3px" id="F08M_sms3_color"> <span id = "F08M_sms3">...</span></td>
  <td style="padding:3px" id="F08M_temp_color"> <span id = "F08M_temp">...</span> </td>
  <td style="padding:3px" id="F08M_battery_color"> <span id = "F08M_battery">...</span> </td> 
</tr>
<tr>
  <td style="padding:3px">G02N</td>
  <td style="padding:3px" id="G02N_status_color"> <span id = "G02N_status">...</span> </td>
  <td style="padding:3px" id="G02N_time_color"> <span id = "G02N_time">...</span> </td>
  <td style="padding:3px" id="G02N_sms1_color"> <span id = "G02N_sms1">...</span></td>
  <td style="padding:3px" id="G02N_sms2_color"> <span id = "G02N_sms2">...</span></td>
  <td style="padding:3px" id="G02N_sms3_color"> <span id = "G02N_sms3">...</span></td>
  <td style="padding:3px" id="G02N_temp_color"> <span id = "G02N_temp">...</span> </td>
  <td style="padding:3px" id="G02N_battery_color"> <span id = "G02N_battery">...</span> </td>  
</tr>
<tr>
  <td style="padding:3px">G02S</td>
  <td style="padding:3px" id="G02S_status_color"> <span id = "G02S_status">...</span> </td>
  <td style="padding:3px" id="G02S_time_color"> <span id = "G02S_time">...</span> </td>
  <td style="padding:3px" id="G02S_sms1_color"> <span id = "G02S_sms1">...</span></td>
  <td style="padding:3px" id="G02S_sms2_color"> <span id = "G02S_sms2">...</span></td>
  <td style="padding:3px" id="G02S_sms3_color"> <span id = "G02S_sms3">...</span></td>
  <td style="padding:3px" id="G02S_temp_color"> <span id = "G02S_temp">...</span> </td>
  <td style="padding:3px" id="G02S_battery_color"> <span id = "G02S_battery">...</span> </td>  
</tr>
<tr>
  <td style="padding:3px">G08M</td>
  <td style="padding:3px" id="G08M_status_color"> <span id = "G08M_status">...</span> </td>
  <td style="padding:3px" id="G08M_time_color"> <span id = "G08M_time">...</span> </td>
  <td style="padding:3px" id="G08M_sms1_color"> <span id = "G08M_sms1">...</span></td>
  <td style="padding:3px" id="G08M_sms2_color"> <span id = "G08M_sms2">...</span></td>
  <td style="padding:3px" id="G08M_sms3_color"> <span id = "G08M_sms3">...</span></td>
  <td style="padding:3px" id="G08M_temp_color"> <span id = "G08M_temp">...</span> </td>
  <td style="padding:3px" id="G08M_battery_color"> <span id = "G08M_battery">...</span> </td>  
</tr>
</table>
</fieldset>
<br>
<br>

<fieldset style="width:750px">
<legend> Error and Issue Messages</legend>
<input type="submit" class="buttons" value="Today" id="issueMessagesToday" style="width:55px"> 
&nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp
Year: <input type="text" id="issueInputYear" style="width:30px" size="4" maxlength="4" name="issueInputYear"> 
Month: <input type="text" id="issueInputMonth" style="width:15px" size="2" maxlength="2" name="issueInputMonth">
Day: <input type="text" id="issueInputDay" style="width:15px" size="2" maxlength="2" name="issueInputDay">
&nbsp &nbsp &nbsp <input type="submit" class="buttons" value="Go" id="issueMessagesSetDate" style="width:35px">
<br>
&nbsp &nbsp &nbsp <i><small>(oldest message in database: <span id = "oldestIssueMessagesDate">...</span>)</small></i>
<br>
<br>
<b>Date: </b> <span id = "issuesMessagesDate">...</span>
<table id = "issueMessagesTable" border="1">
<tr>
  <th align="left" style="width:95px">Date</th>
  <th align="left" style="padding:5px">Stamp+Guard</th>
  <th align="left" style="padding:5px">Message</th>
</tr>
</table>
</fieldset>
<br>
<br>

<fieldset style="width:750px">
<legend> Informational Messages</legend>
<input type="submit" class="buttons" value="Today" id="infoMessagesToday" style="width:55px"> 
&nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp

&nbsp
Year: <input type="text" id="infoInputYear" style="width:30px" size="4" maxlength="4" name="infoInputYear"> 
Month: <input type="text" id="infoInputMonth" style="width:15px" size="2" maxlength="2" name="infoInputMonth">
Day: <input type="text" id="infoInputDay" style="width:15px" size="2" maxlength="2" name="infoInputDay"> 
&nbsp &nbsp &nbsp <input type="submit" class="buttons" value="Go" id="infoMessagesSetDate" style="width:35px">
<br>
&nbsp &nbsp &nbsp <i><small>(oldest message in database: <span id = "oldestInfoMessagesDate">...</span>)</small></i>
<br>
<br>
<b>Date: </b> <span id = "infoMessagesDate">...</span>
<table id = "infoMessagesTable" border="1">
<tr>
  <th align="left" style="width:95px">Date</th>
  <th align="left" style="padding:5px">Stamp+Guard</th>
  <th align="left" style="padding:5px">Message</th>
</tr>
</table>
</fieldset>
<br>
<br>

<fieldset style="width:510px">
<legend> Logon</legend>
<b>User Name:</b> &nbsp &nbsp
<input type="text" id="username" name="username">
<br><br>
<b>Password:</b> &nbsp &nbsp
<input type="password" id="password" name="password">
<br><br>
<button onclick="LogInToApp()" id="logonbutton">Logon</button>
</fieldset>

<script src="amazon-cognito-identity.min.js"> </script>
<script src="https://sdk.amazonaws.com/js/aws-sdk-2.331.0.min.js"></script>

<script>
	  
/////////////////////////////////////////////////////////////////////////////////////////
// Generic data stuctures and utility functions
/////////////////////////////////////////////////////////////////////////////////////////
var vineyard_stations = ["A02N", "A02S", "A08M", "B02N", "B02S", "B08M", "C02N",
                         "C02S", "C08M", "D02N", "D02S", "D08M", "E02N", "E02S", 
						 "E08M", "F02N", "F02S", "F08M", "G02N", "G02S", "G08M"];
var days_in_months = [0,31,28,31,30,31,30,31,31,30,31,30,31];
					   
const CONSOLE 			= 1;
const GUI 				= 2;
const CONSOLE_AND_GUI 	= 3;

const LONG 				= 1;
const SHORT 			= 2;

var oldestIssueMessagesDate = 0;
var issuesMessagesDate = '';

var oldestInfoMessagesDate = 0;
var infoMessagesDate = '';

//handles leap years
function GetDaysOfMonth(year, month)
{
  var days = 0;
  var is_leap = false;
  
  if((year > 0) && ((month > 0) && (month < 13)))
  {
    //detect a leap year
    if (year % 4 != 0)
    {
      is_leap = false;
    }
    else if (year % 100 != 0)
    {
      is_leap = true;
    }
    else if (year % 400 != 0)
    {
      is_leap = false;
    }
    else
    {
      is_leap = true; 
    }
	
	//get the number of days
    if(is_leap && (month == 2))
    {
      days = 29;
    }
    else
	{
      days = days_in_months[month];
	}
  }
  return(days);
}

function SendMessage(destination, message)
{
  if(message.length > 0)
  {
    if((destination == CONSOLE) || (destination == CONSOLE_AND_GUI))
    {
      console.log(message);
    }
  
    if((destination == GUI) || (destination == CONSOLE_AND_GUI))
    {
      document.getElementById("messageToUser").innerHTML = message;
    }
  }
}

function ClearTable(table_id)
{
  var table = document.getElementById(table_id);

  //deletes all rows except the header row
  for(var i = table.rows.length - 1; i > 0; i--)
  {
    table.deleteRow(i);
  }
}

function EnableTheGUI()
{
  document.getElementById("vineyardStationsRefresh").disabled = false;

  document.getElementById("issueMessagesToday").disabled = false;
  document.getElementById("issueMessagesSetDate").disabled = false;
  document.getElementById("infoMessagesToday").disabled = false;
  document.getElementById("infoMessagesSetDate").disabled = false;

  document.getElementById("infoInputYear").disabled = false;
  document.getElementById("infoInputYear").value = '';
  document.getElementById("infoInputMonth").disabled = false;
  document.getElementById("infoInputMonth").value = '';
  document.getElementById("infoInputDay").disabled = false;
  document.getElementById("infoInputDay").value = '';

  document.getElementById("issueInputYear").disabled = false;
  document.getElementById("issueInputYear").value = '';
  document.getElementById("issueInputMonth").disabled = false;
  document.getElementById("issueInputMonth").value = '';
  document.getElementById("issueInputDay").disabled = false;
  document.getElementById("issueInputDay").value = '';
}

function DisableTheGUI()
{
  document.getElementById("vineyardStationsRefresh").disabled = true;

  document.getElementById("issueMessagesToday").disabled = true;
  document.getElementById("issueMessagesSetDate").disabled = true;
  document.getElementById("infoMessagesToday").disabled = true;
  document.getElementById("infoMessagesSetDate").disabled = true;

  document.getElementById("infoInputYear").disabled = true;
  document.getElementById("infoInputYear").value = '';
  document.getElementById("infoInputMonth").disabled = true;
  document.getElementById("infoInputMonth").value = '';
  document.getElementById("infoInputDay").disabled = true;
  document.getElementById("infoInputDay").value = '';

  document.getElementById("issueInputYear").disabled = true;
  document.getElementById("issueInputYear").value = '';
  document.getElementById("issueInputMonth").disabled = true;
  document.getElementById("issueInputMonth").value = '';
  document.getElementById("issueInputDay").disabled = true;
  document.getElementById("issueInputDay").value = '';
}

function ClearInputValues()
{
  document.getElementById("infoInputYear").value = '';
  document.getElementById("infoInputMonth").value = '';  
  document.getElementById("infoInputDay").value = '';
  document.getElementById("issueInputYear").value = '';
  document.getElementById("issueInputMonth").value = '';
  document.getElementById("issueInputDay").value = '';
}

// given a number, return a 2 char string, left padded with '0' if needed
function PadLeftZero(value)
{
  var return_string = "";
  if(value < 10)
  {
    return_string = "0";
  }
  return_string += value.toString();
  return(return_string);
}

//convert epoch time stamp to human readable string. e.g. 2020-12-31T23:59
function TimeStampToHuman(timestamp, mode)
{
  var human_readable = "";

  var reg_exp = new RegExp('^[0-9]+$');
  if(reg_exp.test(timestamp))
  {	
	var date = new Date(timestamp * 1000); //need to supply milliseconds
	var year = date.getFullYear();
	human_readable = year.toString() + "-";
	var month = date.getMonth() + 1;  //due to Jan == 0
	human_readable += PadLeftZero(month)
    if(mode == LONG)
    {
	  var day = date.getDate();
	  human_readable += "-" + PadLeftZero(day) + "T";
	  var hours = date.getHours();
	  human_readable += PadLeftZero(hours) + ":";
	  var minutes = date.getMinutes();
	  human_readable += PadLeftZero(minutes);
	}
  }
  else
  {
	SendMessage(CONSOLE, "Bad argument passed to TimeStampToHuman(). Contains non digits.");
  }

  return(human_readable);
};

//return current date in year-month-day format (e.g., 2019-12-31
function ReturnCurrentYearMonthDay()
{
  var dateObj = new Date();
  var month = dateObj.getMonth() + 1; //due to Jan == 0
  var day = dateObj.getDate();
  var year = dateObj.getFullYear();
  var formattedDate = year.toString() + '-' + PadLeftZero(month) + '-' + PadLeftZero(day);
  return(formattedDate);
}

// take number date, insert hyphens, and return as string (e.g., 20191101 -> '2019-11-01')
function GetDisplayDate(oldest_date)
{
  var output_string = '';
  if(oldest_date != 0)
  {
    var oldest_date_string = oldest_date.toString();
	output_string = oldest_date_string.substring(0,4);
	output_string += '-' + oldest_date_string.substring(4,6);
	output_string += '-' + oldest_date_string.substring(6,8);
  }

  return(output_string);
}

/////////////////////////////////////////////////////////////////////////////////////////
// Security data structures and functions
/////////////////////////////////////////////////////////////////////////////////////////
var THE_REGION = 'us-east-1';
var USER_POOL_ID = 'us-east-1_123456789';
var USER_POOL_APP_CLIENT_ID = '12345678901234567890123456';
var IDENTITY_POOL_ID = 'us-east-1:12345678-1234-1234-1234-123456789012';

// clear user input from log in attempt
function ClearLogInValues()
{
  document.getElementById("password").value = '';
  document.getElementById("username").value = '';
}

// attempt by user to log into web application succeeded
function LogInSuccess(name)
{
  var greeting = "Howdy " + name + "! You have been successfully logged in.";
  SendMessage(GUI, greeting);
  ClearLogInValues();
  document.getElementById("username").disabled = true; 
  document.getElementById("password").disabled = true; 
  document.getElementById("logonbutton").disabled = true;
  
  EnableTheGUI();
  
  GetOldestInfoMessageDate();
  GetOldestIssueMessageDate();
  
  LoadMostRecentSensorReadings();
  LoadFirstPageOfIssueMessages();
  LoadFirstPageOfInfoMessages();
}

// attempt by user to log into web application failed
function LogInFailure()
{
  SendMessage(GUI, "Sorry partner! Please try to log in again.");
  ClearLogInValues();
}

// process user's attempt to log into the web application  	  
function LogInToApp()
{
  SendMessage(GUI, "Attempting to log you in...");
  var authenticationData = 
  {
    Username : document.getElementById("username").value,
    Password : document.getElementById("password").value
  }; 
  var authenticationDetails = 
    new AmazonCognitoIdentity.AuthenticationDetails(authenticationData);
  var poolData = 
  { 
	UserPoolId : USER_POOL_ID,
	ClientId : USER_POOL_APP_CLIENT_ID
  };
  var userPool = new AmazonCognitoIdentity.CognitoUserPool(poolData);
  var userData = 
  { 
    Username : document.getElementById("username").value,
    Pool : userPool
  };
  var cognitoUser = new AmazonCognitoIdentity.CognitoUser(userData);
  cognitoUser.authenticateUser(authenticationDetails, 
  {
    onSuccess: function (result) 
	{
	  var accessToken = result.getAccessToken().getJwtToken();
	  AWS.config.region = THE_REGION;
      AWS.config.credentials = new AWS.CognitoIdentityCredentials(
	    {
          IdentityPoolId : IDENTITY_POOL_ID,
		  Logins : 
		  { 	
		    //'cognito-idp.' + <aws region> + '.amazonaws.com/' + <cognito user pool id>
			'cognito-idp.us-east-1.amazonaws.com/us-east-1_123456789'  : 
		    result.getIdToken().getJwtToken()
          }
        }
	  );

      AWS.config.credentials.refresh((error) => 
	    {
          if (error) 
		  {
		    SendMessage(CONSOLE, "Error: credentials refresh failed.");
		    SendMessage(CONSOLE, error);
		    LogInFailure();
          } 
		  else 
		  {
		    SendMessage(CONSOLE, 'Successfully logon and credential refresh.');
		    LogInSuccess(userData.Username);
			//now JavaScript functions can access AWS resources
		    AWS.config.update(
			  {
		        accessKeyId: AWS.config.credentials.accessKeyId, 
			    secretAccessKey: AWS.config.credentials.secretAccessKey,
			    sessionToken: AWS.config.credentials.sessionToken
		      }
		    );
          }
        }
	  );
    },

    onFailure: function(err) 
	{
	  SendMessage(CONSOLE, "Failure to log user into application.");
	  SendMessage(CONSOLE, err);
	  LogInFailure();
    },
    
    // MFA not used with this application
	mfaRequired: function(codeDeliveryDetails) 
	{
      var verificationCode = prompt('Please input verification code' ,'');
      cognitoUser.sendMFACode(verificationCode, this);
    },
	
	newPasswordRequired: function(userAttributes, requiredAttributes) 
	{
	  var newPassword = prompt("Please enter a new password. You must use an upper, " +
                               "lower, number, and a special; min 8 chars.", "");
	  if (newPassword == null || newPassword == "" || newPassword.length < 8)
      {
	    SendMessage(CONSOLE, "New password malformed.  Password reset failed.");
		LogInFailure();
	  }
	  else
	  {
	    document.getElementById("password").setAttribute('value',newPassword);
	    cognitoUser.completeNewPasswordChallenge(newPassword, null, this);
	    LogInSuccess(userData.Username);
		SendMessage(CONSOLE, "Password reset succeeded.");
      }
	}
  });
}

/////////////////////////////////////////////////////////////////////////////////////////
// Vineyard Stations Status Functions
/////////////////////////////////////////////////////////////////////////////////////////
function HookUpVineyardStationButtons()
{    
  document.getElementById("vineyardStationsRefresh").onclick = function()
    { RefreshVineyardStationsDisplay(); } 
}

function RefreshVineyardStationsDisplay()
{
  LoadMostRecentSensorReadings();
}


//Load the latest values for all sensor stations, both online ('status' cell will be marked
//green) and offline ('status' cell will be marked red).  For online stations, mark suspect
//sensor values (i.e., values which may constitute an alarm state) yellow.  A yellow indicator 
//is not definitive indication of an alarm state because data shelf life is not considered and 
//the full soil moisture algorithm is not executed.
//
//NOTE: Breaking this function up (i.e., separate AWS calls) would introduce race condition issues 
//stemming from asynchronous nature of the access to AWS resources.  Specifically, it is likely 
//that variables holding control values retrieved from table_name2 would still be undefined 
//at the time an attempt is made to color code cells based on current sensor readings.
function LoadMostRecentSensorReadings()
{
  SendMessage(GUI, "Loading most recent readings for all sensors...");
   	
  var docClient = new AWS.DynamoDB.DocumentClient();
  var params = 
  {
    TableName: 'table_name1',
    Key:
	{
      "control_id": '1'
    }
  }
  
  //get the sensor threshold values
  docClient.get(params, function(err, data) 
  {
    if (err) 
	{
	  SendMessage(CONSOLE_AND_GUI, "Cannot read the DynamoDB table table_name1." +
	                               " Try logging in again or launching a new browser.");
	  SendMessage(CONSOLE, err);
    } 
	else 
	{			
	  var absence_thresh =  parseInt(data.Item.absence_thresh);
	  var temp_thresh    =  parseFloat(data.Item.freeze_thresh);
      var battery_thresh = parseFloat(data.Item.battery_thresh);
	  var moist_thresh   = 99999999999;
	  var current_ts     = Math.trunc(Date.now() / 1000);
		
	  for (var index = 0; index < vineyard_stations.length; index++)
      {
		if(parseInt(data.Item.moisture_thresh[vineyard_stations[index]]) < moist_thresh)
		{
		  moist_thresh = parseInt(data.Item.moisture_thresh[vineyard_stations[index]]);
		}
	  }
		
	  //get the most current sensor values; load value and color code cells
	  var docClient = new AWS.DynamoDB.DocumentClient();
      var params = 
      {
        TableName: 'table_name4'
      };
   
      docClient.scan(params, function(err, data)
      {
        if(err) 
        {
          SendMessage(CONSOLE_AND_GUI, "Could not scan the DynamoDB table " +
	        "table_name4. Try logging in again or launching a new browser.");
	      SendMessage(CONSOLE, err);
        } 
        else 
        {
		  data.Items.forEach(function(statusRecord) 
	      {
		    document.getElementById(statusRecord.location + "_status").innerHTML = statusRecord.tstatus;
	        if(statusRecord.tstatus == 'online')
	        {
	          document.getElementById(statusRecord.location + '_status_color').bgColor = "lightgreen";
	        }
			else
		    {
		      document.getElementById(statusRecord.location + '_status_color').bgColor = "salmon";  
			}
			
	        document.getElementById(statusRecord.location + "_time").innerHTML = 
	          TimeStampToHuman(statusRecord.tstamp, LONG);
	        document.getElementById(statusRecord.location + "_time_color").bgColor = "white";
		    if((statusRecord.tstatus == 'online') && 
			   (current_ts - statusRecord.tstamp > (absence_thresh * 86,400))) //86,400 secs in a day
	        {
	          document.getElementById(statusRecord.location + "_time_color").bgColor = "lightyellow";
	        }
			  
		    document.getElementById(statusRecord.location + "_temp").innerHTML = statusRecord.temperature;
	        document.getElementById(statusRecord.location + "_temp_color").bgColor = "white";
			if((statusRecord.tstatus == 'online') && (parseFloat(statusRecord.temperature) <= temp_thresh))
	        {
	          document.getElementById(statusRecord.location + "_temp_color").bgColor = "lightyellow";
	        }
			 
		    document.getElementById(statusRecord.location + "_sms1").innerHTML = statusRecord.sms1;
	        document.getElementById(statusRecord.location + "_sms1_color").bgColor = "white"; 
		    if((statusRecord.tstatus == 'online') && (parseInt(statusRecord.sms1) >= moist_thresh))
	        {
	          document.getElementById(statusRecord.location + "_sms1_color").bgColor = "lightyellow";
	        }
			  
		    document.getElementById(statusRecord.location + "_sms2").innerHTML = statusRecord.sms2;
	        document.getElementById(statusRecord.location + "_sms2_color").bgColor = "white"; 
		    if((statusRecord.tstatus == 'online') && (parseInt(statusRecord.sms2) >= moist_thresh))
	        {
	          document.getElementById(statusRecord.location + "_sms2_color").bgColor = "lightyellow";
	        }
			  
			document.getElementById(statusRecord.location + "_sms3").innerHTML = statusRecord.sms3;
	        document.getElementById(statusRecord.location + "_sms3_color").bgColor = "white"; 
			if((statusRecord.tstatus == 'online') && (parseInt(statusRecord.sms3) >= moist_thresh))
	        {
	          document.getElementById(statusRecord.location + "_sms3_color").bgColor = "lightyellow";
	        }
			  
		    document.getElementById(statusRecord.location + "_battery").innerHTML = statusRecord.battery;
	        document.getElementById(statusRecord.location + "_battery_color").bgColor = "white"; 
		    if((statusRecord.tstatus == 'online') && (parseFloat(statusRecord.battery) <= battery_thresh))
	        {
	          document.getElementById(statusRecord.location + "_battery_color").bgColor = "lightyellow";
	        }
		  }); 
		  
		  SendMessage(GUI, "Finished loading most recent sensor status.");
        } 
      });
	}
  });
}
  
 
/////////////////////////////////////////////////////////////////////////////////////////
// Issue Messages Functions
/////////////////////////////////////////////////////////////////////////////////////////
function HookUpIssueMessagesButtons()
{    
  document.getElementById("issueMessagesToday").onclick = function()
    { LoadFirstPageOfIssueMessages(); } 
  document.getElementById("issueMessagesSetDate").onclick = function()
    { LoadSpecificDateOfIssueMessages(document.getElementById("issueInputYear").value,
	    document.getElementById("issueInputMonth").value, 
		document.getElementById("issueInputDay").value);  }	
}

function GetOldestIssueMessageDate()
{
  SendMessage(GUI, "Scanning all issue messages to identify oldest...");
  var docClient = new AWS.DynamoDB.DocumentClient();
  var params = 
  {
    TableName: 'table_name5',
	ProjectionExpression: '#d',
	ExpressionAttributeNames:{'#d': 'date'}
  };
  docClient.scan(params, OnIssueMessagesScan);
}

// scan database with issue messages, find oldest date, and set global variable.
// the entire point of exercise is to tell user date of oldest message.
function OnIssueMessagesScan(err, data)
{
  if (err) 
  {
    SendMessage(CONSOLE, "Error during table_name5 DynamoDB table scan.");
	SendMessage(CONSOLE, err);
    SendMessage(GUI, "Could not load page of issue messages.");
	oldestIssueMessagesDate = 0;
    document.getElementById("oldestIssueMessagesDate").innerHTML = '...';
  } 
  else 
  {
	if(data.Count > 0)
	{
      var dateValue = 0;
      data.Items.forEach(
	    function(item) 
	    {
		  dateValue = parseInt(item.date.replaceAll('-',''));
		  if (oldestIssueMessagesDate == 0)
		  {
		    oldestIssueMessagesDate = dateValue;
		  }
		  else
		  {
			if(dateValue < oldestIssueMessagesDate)
			{
			  oldestIssueMessagesDate = dateValue;
			}
          }
		});
	  
      SendMessage(GUI, "Finished loading a page of issue messages.");

      //is there more than a single result set page?
      if (typeof data.LastEvaluatedKey != "undefined") 
	  { 
	    var params = 
        {
          TableName: 'table_name5',
	      ExclusiveStartKey: data.LastEvaluatedKey,
		  ProjectionExpression: '#d',
	      ExpressionAttributeNames:{'#d': 'date'}
        };
	  
        var docClient = new AWS.DynamoDB.DocumentClient();
	    SendMessage(GUI, "Loading next page of issue messages...");
        docClient.scan(params, OnIssueMessagesScan);
	  }
	  else
	  {
	    SendMessage(GUI, "Finished scanning all issue messages.");
	    
		//tell user date of oldest message in database	
	    if(oldestIssueMessagesDate != 0)
	    {
          document.getElementById("oldestIssueMessagesDate").innerHTML = 
	        GetDisplayDate(oldestIssueMessagesDate);
	      oldestIssueMessagesDate = 0;
	    }
	    else
	    {
	      document.getElementById("oldestIssueMessagesDate").innerHTML = '...';
	    }
	  }
	}
	else
	{
      SendMessage(GUI, "Issue database contains no messages.");
	  document.getElementById("oldestIssueMessagesDate").innerHTML = '...';
	  oldestIssueMessagesDate = 0;
	}
  }
}

//load first page of error messages (most recent first)
function LoadFirstPageOfIssueMessages()
{
  ClearTable("issueMessagesTable");
  issuesMessagesDate = ReturnCurrentYearMonthDay();
  var params = 
  {
    TableName: 'table_name5',
	KeyConditionExpression: '#dt = :d',
	ScanIndexForward: false,
    ExpressionAttributeNames: {'#dt': 'date'},
	ExpressionAttributeValues: {':d': issuesMessagesDate}
  };
  
  var docClient = new AWS.DynamoDB.DocumentClient();
  SendMessage(GUI, "Loading most recent issue messages...");
  docClient.query(params, OnIssueMessagesQuery);
}

//there are no issue messages older than 2020
function LoadSpecificDateOfIssueMessages(year, month, day)
{
  year_str = year.trim();
  month_str = month.trim();
  day_str = day.trim();

  var reg_exp = new RegExp('^[0-9]+$');  //digits only
  if((reg_exp.test(year_str)) && (reg_exp.test(month_str)) && (reg_exp.test(day_str)))
  {
    year_int = parseInt(year_str);
    month_int = parseInt(month_str);
    day_int = parseInt(day_str);
    if((year_int > 2019) && ((month_int > 0) && (month_int < 13)) &&
       ((day_int > 0) && (day_int <= GetDaysOfMonth(year_int, month_int)))) 
    {
	  ClearTable("issueMessagesTable");
	  issuesMessagesDate = year + '-' + PadLeftZero(month_int) + '-' + PadLeftZero(day_int);
      var params = 
      {
        TableName: 'table_name5',
		ScanIndexForward: false,
	    KeyConditionExpression: '#dt = :d',
        ExpressionAttributeNames: {'#dt': 'date'},
	    ExpressionAttributeValues: {':d': issuesMessagesDate}
      };
  
      var docClient = new AWS.DynamoDB.DocumentClient();
      SendMessage(GUI, "Loading issue messages for specific date...");
      docClient.query(params, OnIssueMessagesQuery);
    }
	else
	{
	  alert("An invalid date was specified.");
	  ClearInputValues();
	  issuesMessagesDate = '';
	}
  }
  else
  {
    alert("Please enter digits (e.g., 0-9) to specify desired date."); 
	ClearInputValues();
	issuesMessagesDate = '';
  }
}

function OnIssueMessagesQuery(err, data)
{
  if (err) 
  {
    SendMessage(CONSOLE, "Error during table_name5 DynamoDB table query.");
	SendMessage(CONSOLE, err);
    SendMessage(GUI, "Could not load page of issue messages.");
	ClearInputValues();
    issuesMessagesDate = '';
  } 
  else 
  {
  	document.getElementById("issuesMessagesDate").innerHTML = issuesMessagesDate;
	if(data.Count > 0)
	{
      var table = document.getElementById("issueMessagesTable").getElementsByTagName('tbody')[0];
	  var rowCount = 1;
      var newRow;
      data.Items.forEach(
	    function(item) 
	    {
		  newRow = table.insertRow(table.rows.length);
		  if(rowCount % 2 != 0)
		  {
		    newRow.bgColor = 'lightgray';
	      }
          newRow.innerHTML = "<tr><td>" + item.date + "</td>" +
		                         "<td>" + item.stamp_job + "</td>" +
					             "<td>"+ item.message + "</td></tr>";
          ++rowCount;
		}
	  );
	  
      SendMessage(GUI, "Finished loading a page of issue messages.");

      //is there more than a single result set page?
      if (typeof data.LastEvaluatedKey != "undefined") 
	  { 
	    var params = 
        {
          TableName: 'table_name5',
	      ExclusiveStartKey: data.LastEvaluatedKey,
	      KeyConditionExpression: '#dt = :d',
          ExpressionAttributeNames: {'#dt': 'date'},
	      ExpressionAttributeValues: {':d': issuesMessagesDate}
        };
	  
        var docClient = new AWS.DynamoDB.DocumentClient();
	    SendMessage(GUI, "Loading next page of issue messages...");
        docClient.query(params, OnIssueMessagesQuery);
	  }
	  else
	  {
	    SendMessage(GUI, "Finished loading all issue messages.");
	    ClearInputValues();
        issuesMessagesDate = '';
	  }
	}
	else
	{
      SendMessage(GUI, "No issue messages in database for specified date.");
	  ClearInputValues();
      issuesMessagesDate = '';
	}
  }
}

/////////////////////////////////////////////////////////////////////////////////////////
// Info Messages Functions
/////////////////////////////////////////////////////////////////////////////////////////
function HookUpInfoMessagesButtons()
{    
  document.getElementById("infoMessagesToday").onclick = function()
    { LoadFirstPageOfInfoMessages(); } 
  document.getElementById("infoMessagesSetDate").onclick = function()
	{ LoadSpecificDateOfInfoMessages(document.getElementById("infoInputYear").value,
	  document.getElementById("infoInputMonth").value, 
	  document.getElementById("infoInputDay").value);  }	
}

function GetOldestInfoMessageDate()
{
  SendMessage(GUI, "Scanning all info messages to idenfity oldest...");
  var docClient = new AWS.DynamoDB.DocumentClient();
  var params = 
  {
    TableName: 'table_name3',
	ProjectionExpression: '#d',
	ExpressionAttributeNames:{'#d': 'date'}
  };
  docClient.scan(params, OnInfoMessagesScan);
}

// scan database with info messages, find oldest, and set global variable.   
// the entire point of the exercise is to inform user of date of oldest message
function OnInfoMessagesScan(err, data)
{
  if (err) 
  {
    SendMessage(CONSOLE, "Error during table_name3 DynamoDB table scan.");
	SendMessage(CONSOLE, err);
    SendMessage(GUI, "Could not load page of info messages.");
	oldestInfoMessagesDate = 0;
    document.getElementById("oldestInfoMessagesDate").innerHTML = '...';
  } 
  else 
  {
	if(data.Count > 0)
	{
	  var dateValue = 0;
      data.Items.forEach(
	    function(item) 
	    {
		  dateValue = parseInt(item.date.replaceAll('-',''));
		  if (oldestInfoMessagesDate == 0)
		  {
		    oldestInfoMessagesDate = dateValue;
		  }
		  else
		  {
			if(dateValue < oldestInfoMessagesDate)
			{
			  oldestInfoMessagesDate = dateValue;
			}
          }
		});
	  
      SendMessage(GUI, "Finished loading a page of info messages.");

      //is there more than a single result set page?
      if (typeof data.LastEvaluatedKey != "undefined") 
	  {
	  
	    var params = 
        {
          TableName: 'table_name3',
	      ExclusiveStartKey: data.LastEvaluatedKey,
		  ProjectionExpression: '#d',
	      ExpressionAttributeNames:{'#d': 'date'}
        };
	  
        var docClient = new AWS.DynamoDB.DocumentClient();
	    SendMessage(GUI, "Loading next page of info messages...");
        docClient.scan(params, OnInfoMessagesScan);
	  }
	  else
	  {
	    SendMessage(GUI, "Finished scanning all info messages.");
		//tell user date of oldest message
	    if(oldestInfoMessagesDate != 0)
	    {
	      document.getElementById("oldestInfoMessagesDate").innerHTML = 
	        GetDisplayDate(oldestInfoMessagesDate);
		  oldestInfoMessagesDate = 0;
			
	    }
	    else
	    {
	      document.getElementById("oldestInfoMessagesDate").innerHTML = '...';
	    }
	  }
	}
	else
	{
      SendMessage(GUI, "No info messages in database.");
	  document.getElementById("oldestInfoMessagesDate").innerHTML = '...';
	  oldestInfoMessagesDate = 0;
	}
  }
}

function LoadFirstPageOfInfoMessages()
{
  ClearTable("infoMessagesTable");
  infoMessagesDate = ReturnCurrentYearMonthDay();
  var params = 
  {
    TableName: 'table_name3',
	KeyConditionExpression: '#dt = :d',
	ScanIndexForward: false,
    ExpressionAttributeNames: {'#dt': 'date'},
	ExpressionAttributeValues: {':d': infoMessagesDate}
  };
  
  var docClient = new AWS.DynamoDB.DocumentClient();
  SendMessage(GUI, "Loading most recent information messages...");
  docClient.query(params, OnInfoMessagesQuery);
}

// no information messages exist that are older than a 2020 date
function LoadSpecificDateOfInfoMessages(year, month, day)
{
  year_str = year.trim();
  month_str = month.trim();
  day_str = day.trim();

  var reg_exp = new RegExp('^[0-9]+$');  //digits only
  if((reg_exp.test(year_str)) && (reg_exp.test(month_str)) && (reg_exp.test(day_str)))
  {
    year_int = parseInt(year_str);
    month_int = parseInt(month_str);
    day_int = parseInt(day_str); 
    if((year_int > 2019) && ((month_int > 0) && (month_int < 13)) &&
       ((day_int > 0) && (day_int <= GetDaysOfMonth(year_int, month_int)))) 
    {
	  ClearTable("infoMessagesTable");
	  infoMessagesDate = year + '-' + PadLeftZero(month_int) + '-' + PadLeftZero(day_int);
      var params = 
      {
        TableName: 'table_name3',
		ScanIndexForward: false,
	    KeyConditionExpression: '#dt = :d',
        ExpressionAttributeNames: {'#dt': 'date'},
	    ExpressionAttributeValues: {':d': infoMessagesDate}
      };
  
      var docClient = new AWS.DynamoDB.DocumentClient();
      SendMessage(GUI, "Loading information messages for specific date...");
      docClient.query(params, OnInfoMessagesQuery);
    }
	else
	{
	  alert("An invalid date was specified.");
	  ClearInputValues();
	  infoMessagesDate = '';
	}
  }
  else
  {
    alert("Please enter digits (e.g., 0-9) to specify desired date."); 
	ClearInputValues();
	infoMessagesDate = '';
  }
}

function OnInfoMessagesQuery(err, data)
{
  if (err) 
  {
    SendMessage(CONSOLE, "Error during table_name3 DynamoDB table query.");
	SendMessage(CONSOLE, err);
    SendMessage(GUI, "Could not load page of information messages.");
	ClearInputValues();
    infoMessagesDate = '';
  } 
  else 
  {
  	document.getElementById("infoMessagesDate").innerHTML = infoMessagesDate;
	if(data.Count > 0)
	{
      var table = document.getElementById("infoMessagesTable").getElementsByTagName('tbody')[0];
      var newRow;
	  var rowCount = 1;
      data.Items.forEach(
	    function(item) 
	    {
		  newRow = table.insertRow(table.rows.length);
		  if(rowCount % 2 != 0)
		  {
		    newRow.bgColor = 'lightgray';
	      }
          newRow.innerHTML = "<tr><td>" + item.date + "</td>" +
		                         "<td>" + item.stamp_job + "</td>" +
					             "<td>"+ item.message + "</td></tr>";
		  ++rowCount;
        }
	  );
	 
      SendMessage(GUI, "Finished loading a page of information messages.");

      //is there more than a single result set page?
      if (typeof data.LastEvaluatedKey != "undefined") 
	  { 
	    var params = 
        {
          TableName: 'table_name3',
	      ExclusiveStartKey: data.LastEvaluatedKey,
	      KeyConditionExpression: '#dt = :d',
          ExpressionAttributeNames: {'#dt': 'date'},
	      ExpressionAttributeValues: {':d': infoMessagesDate}
        };
	  
        var docClient = new AWS.DynamoDB.DocumentClient();
	    SendMessage(GUI, "Loading next page of information messages...");
        docClient.query(params, OnInfoMessagesQuery);
	  }
	  else
	  {
	    SendMessage(GUI, "Finished loading all information messages.");
	    ClearInputValues();
        infoMessagesDate = '';
	  }
	}
	else
	{
      SendMessage(GUI, "No information messages in database for specified date.");
	  ClearInputValues();
      infoMessagesDate = '';
	}
  }
}
  
/////////////////////////////////////////////////////////////////////////////////////////
// The following script commands will be executed once: at page load time
/////////////////////////////////////////////////////////////////////////////////////////
DisableTheGUI();

HookUpVineyardStationButtons();
HookUpIssueMessagesButtons();
HookUpInfoMessagesButtons();

</script>

</body>
</html>